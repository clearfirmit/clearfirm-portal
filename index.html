<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ClearFirm - Business Intelligence Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <style>
        :root {
            --clearfirm-green: #6B7B3A;
            --clearfirm-ocean: #071F52;
        }
        .gradient-bg {
            background: linear-gradient(135deg, var(--clearfirm-green) 0%, var(--clearfirm-ocean) 100%);
        }
        .btn-primary {
            background-color: var(--clearfirm-green);
            color: white;
        }
        .btn-primary:hover {
            background-color: #5a6a32;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="app"></div>

    <script>
        // Configuration
        const API_URL = 'https://clearfirm-api.onrender.com/api';
        
        // Simple router
        class Router {
            constructor() {
                this.routes = {};
                window.addEventListener('popstate', () => this.handleRoute());
                document.addEventListener('click', (e) => {
                    if (e.target.tagName === 'A' && e.target.href.startsWith(window.location.origin)) {
                        e.preventDefault();
                        this.navigate(new URL(e.target.href).pathname);
                    }
                });
            }

            addRoute(path, handler) {
                this.routes[path] = handler;
            }

            navigate(path) {
                window.history.pushState({}, '', path);
                this.handleRoute();
            }

            handleRoute() {
                const path = window.location.pathname;
                const handler = this.routes[path] || this.routes['/'];
                if (handler) handler();
            }
        }

        const router = new Router();
        const app = document.getElementById('app');

        // Pages
        const renderHome = () => {
            app.innerHTML = `
                <div class="min-h-screen">
                    <nav class="bg-white shadow-sm">
                        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                            <div class="flex justify-between h-16">
                                <div class="flex items-center">
                                    <span class="text-2xl font-bold" style="color: var(--clearfirm-green)">ClearFirm</span>
                                </div>
                                <div class="flex items-center space-x-4">
                                    <a href="/admin" class="text-gray-700 hover:text-gray-900">Admin</a>
                                    <a href="/login" class="text-gray-700 hover:text-gray-900">Login</a>
                                </div>
                            </div>
                        </div>
                    </nav>
                    <div class="gradient-bg text-white py-20">
                        <div class="max-w-7xl mx-auto px-4 text-center">
                            <h1 class="text-4xl md:text-6xl font-bold mb-4">
                                Business Intelligence Made Simple
                            </h1>
                            <p class="text-xl mb-8">Verify any business instantly</p>
                        </div>
                    </div>
                </div>
            `;
        };

        const renderAdmin = () => {
            const token = localStorage.getItem('adminToken');
            if (!token) {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center">
                        <div class="bg-white p-8 rounded-lg shadow-md w-96">
                            <h2 class="text-2xl font-bold mb-6">Admin Login</h2>
                            <form id="adminLoginForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="email" required class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <div class="mb-6">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                    <input type="password" id="password" required class="w-full px-3 py-2 border rounded-md">
                                </div>
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700">
                                    Login
                                </button>
                            </form>
                            <p class="text-sm text-center mt-4">
                                <a href="/" class="text-blue-600 hover:underline">Back to Home</a>
                            </p>
                        </div>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('adminLoginForm')?.addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const email = document.getElementById('email').value;
                        const password = document.getElementById('password').value;
                        
                        try {
                            const response = await fetch(`${API_URL}/auth/login`, {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ email, password })
                            });
                            
                            const data = await response.json();
                            if (response.ok && data.user.is_admin) {
                                localStorage.setItem('adminToken', data.token);
                                localStorage.setItem('adminUser', JSON.stringify(data.user));
                                renderAdminDashboard();
                            } else {
                                alert('Admin access required');
                            }
                        } catch (error) {
                            alert('Login failed');
                        }
                    });
                }, 100);
            } else {
                renderAdminDashboard();
            }
        };

        const renderAdminDashboard = () => {
            app.innerHTML = `
                <div class="min-h-screen bg-gray-100">
                    <header class="bg-white border-b">
                        <div class="max-w-7xl mx-auto px-4 py-4">
                            <div class="flex justify-between">
                                <h1 class="text-2xl font-bold">Admin Dashboard</h1>
                                <button onclick="logout()" class="text-sm text-gray-600 hover:text-gray-900">Logout</button>
                            </div>
                        </div>
                    </header>
                    <main class="max-w-7xl mx-auto px-4 py-8">
                        <div class="bg-white rounded-lg shadow p-6">
                            <h2 class="text-lg font-semibold mb-4">Welcome to Admin Dashboard</h2>
                            <p>Full admin functionality coming soon...</p>
                        </div>
                    </main>
                </div>
            `;
        };

        const renderLogin = () => {
            app.innerHTML = `
                <div class="min-h-screen flex items-center justify-center">
                    <div class="bg-white p-8 rounded-lg shadow-md w-96">
                        <h2 class="text-2xl font-bold mb-6">Login</h2>
                        <form id="loginForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" id="email" required class="w-full px-3 py-2 border rounded-md">
                            </div>
                            <div class="mb-6">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Password</label>
                                <input type="password" id="password" required class="w-full px-3 py-2 border rounded-md">
                            </div>
                            <button type="submit" class="w-full btn-primary py-2 rounded-md">Login</button>
                        </form>
                        <p class="text-sm text-center mt-4">
                            <a href="/" class="text-green-600 hover:underline">Back to Home</a>
                        </p>
                    </div>
                </div>
            `;
            
            setTimeout(() => {
                document.getElementById('loginForm')?.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const email = document.getElementById('email').value;
                    const password = document.getElementById('password').value;
                    
                    try {
                        const response = await fetch(`${API_URL}/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ email, password })
                        });
                        
                        const data = await response.json();
                        if (response.ok) {
                            localStorage.setItem('token', data.token);
                            localStorage.setItem('user', JSON.stringify(data.user));
                            alert('Login successful!');
                            router.navigate('/');
                        } else {
                            alert(data.error || 'Login failed');
                        }
                    } catch (error) {
                        alert('Login failed');
                    }
                });
            }, 100);
        };

        function logout() {
            localStorage.removeItem('adminToken');
            localStorage.removeItem('adminUser');
            router.navigate('/admin');
        }

        // Set up routes
        router.addRoute('/', renderHome);
        router.addRoute('/admin', renderAdmin);
        router.addRoute('/login', renderLogin);

        // Initialize
        router.handleRoute();
        window.logout = logout;
    </script>
</body>
</html>
